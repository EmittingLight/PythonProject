import pandas as pd
import os

# Папки проекта
DB_FOLDER = os.path.abspath('./db')  # Папка для хранения базы данных
OUTPUT_FOLDER = os.path.abspath('./output')  # Папка для сохранения экспортированных файлов

# Проверка и создание папок, если они не существуют
os.makedirs(DB_FOLDER, exist_ok=True)  # Создаем папку для базы данных, если она не существует
os.makedirs(OUTPUT_FOLDER, exist_ok=True)  # Создаем папку для экспортированных файлов, если она не существует

# Путь к файлу базы данных Excel
DB_PATH = os.path.join(DB_FOLDER, 'schedule.xlsx')  # Путь к файлу базы данных расписания

# Функция для создания базы данных в Excel
def create_excel_db():
    # Данные расписания
    schedule_data = [
        {'вуз': 'Университет Естественных Наук', 'факультет': 'Факультет Естественных Наук', 'имя_группы': 'Группа А', 'предмет': 'Математика', 'день': 'Понедельник', 'время': '10:00', 'Преподаватель': 'Иван Иванов'},
        {'вуз': 'Университет Естественных Наук', 'факультет': 'Факультет Естественных Наук', 'имя_группы': 'Группа А', 'предмет': 'Физика', 'день': 'Среда', 'время': '12:00', 'Преподаватель': 'Петр Петров'},
        {'вуз': 'Университет Химических Технологий', 'факультет': 'Факультет Химии', 'имя_группы': 'Группа Б', 'предмет': 'Химия', 'день': 'Вторник', 'время': '09:00', 'Преподаватель': 'Сидр Сидоров'},
        {'вуз': 'Университет Биологии', 'факультет': 'Факультет Биологии', 'имя_группы': 'Группа В', 'предмет': 'Биология', 'день': 'Понедельник', 'время': '11:00', 'Преподаватель': 'Анна Антонова'},
        {'вуз': 'Университет Биологии', 'факультет': 'Факультет Истории', 'имя_группы': 'Группа В', 'предмет': 'История', 'день': 'Четверг', 'время': '14:00', 'Преподаватель': 'Мария Марьина'},
        {'вуз': 'Университет Географии', 'факультет': 'Факультет Географии', 'имя_группы': 'Группа Г', 'предмет': 'География', 'день': 'Пятница', 'время': '13:00', 'Преподаватель': 'Олег Олегов'},
        {'вуз': 'Университет Литературы', 'факультет': 'Факультет Литературы', 'имя_группы': 'Группа Г', 'предмет': 'Литература', 'день': 'Среда', 'время': '15:00', 'Преподаватель': 'Наталья Наталова'},
        {'вуз': 'Университет Компьютерных Наук', 'факультет': 'Факультет Компьютерных Наук', 'имя_группы': 'Группа Д', 'предмет': 'Информатика', 'день': 'Понедельник', 'время': '09:00', 'Преподаватель': 'Алексей Алексеев'},
        {'вуз': 'Университет Спорта', 'факультет': 'Факультет Спорта', 'имя_группы': 'Группа Д', 'предмет': 'Физкультура', 'день': 'Вторник', 'время': '16:00', 'Преподаватель': 'Владимир Владимиров'}
    ]

    # Создание DataFrame из данных расписания
    df = pd.DataFrame(schedule_data)

    # Сохранение базы данных в Excel
    df.to_excel(DB_PATH, index=False, engine='openpyxl')  # Сохраняем данные в файл Excel, указываем движок 'openpyxl'
    print(f"База данных расписания создана в файле {DB_PATH}")

# Функция для экспорта данных в Excel для указанного уровня (группа, факультет, вуз)
def export_schedule_to_excel(level, name=None):
    # Чтение базы данных из Excel
    df = pd.read_excel(DB_PATH, engine='openpyxl')  # Читаем данные из файла Excel с помощью движка 'openpyxl'

    # Проверка, что данные загружены правильно
    if df.empty:
        print(f"Файл {DB_PATH} пустой или не содержит данных.")
        return

    # Фильтрация данных в зависимости от уровня
    if level == 'группа' and name is not None:
        # Фильтрация данных по группе
        filtered_data = df[df['имя_группы'] == name]
        output_file = os.path.join(OUTPUT_FOLDER, f"{name}_schedule.xlsx")
    elif level == 'факультет' and name is not None:
        # Фильтрация данных по факультету
        filtered_data = df[df['факультет'] == name]
        output_file = os.path.join(OUTPUT_FOLDER, f"{name}_faculty_schedule.xlsx")
    elif level == 'вуз' and name is not None:
        # Фильтрация данных по вузу
        filtered_data = df[df['вуз'] == name]
        output_file = os.path.join(OUTPUT_FOLDER, f"{name}_university_schedule.xlsx")
    else:
        # Неверный уровень или имя для фильтрации
        print("Неверный уровень или имя для фильтрации.")
        return

    # Проверка, если данные найдены
    if filtered_data.empty:
        print(f"Данные для {name} не найдены.")
    else:
        # Сохранение результата в файл Excel
        filtered_data.to_excel(output_file, index=False, engine='openpyxl')  # Сохраняем отфильтрованные данные в Excel
        print(f"Расписание для уровня '{level}' сохранено в файл {output_file}")

if __name__ == "__main__":
    # Создание базы данных в Excel
    create_excel_db()
    # Экспорт расписания в Excel для всех уровней
    export_schedule_to_excel('группа', 'Группа А')  # Экспорт расписания для группы А
    export_schedule_to_excel('группа', 'Группа Б')  # Экспорт расписания для группы Б
    export_schedule_to_excel('группа', 'Группа В')  # Экспорт расписания для группы В
    export_schedule_to_excel('группа', 'Группа Г')  # Экспорт расписания для группы Г
    export_schedule_to_excel('группа', 'Группа Д')  # Экспорт расписания для группы Д
    export_schedule_to_excel('факультет', 'Факультет Естественных Наук')  # Экспорт расписания для факультета Естественных Наук
    export_schedule_to_excel('факультет', 'Факультет Химии')  # Экспорт расписания для факультета Химии
    export_schedule_to_excel('факультет', 'Факультет Биологии')  # Экспорт расписания для факультета Биологии
    export_schedule_to_excel('факультет', 'Факультет Истории')  # Экспорт расписания для факультета Истории
    export_schedule_to_excel('факультет', 'Факультет Географии')  # Экспорт расписания для факультета Географии
    export_schedule_to_excel('факультет', 'Факультет Литературы')  # Экспорт расписания для факультета Литературы
    export_schedule_to_excel('факультет', 'Факультет Компьютерных Наук')  # Экспорт расписания для факультета Компьютерных Наук
    export_schedule_to_excel('факультет', 'Факультет Спорта')  # Экспорт расписания для факультета Спорта
    export_schedule_to_excel('вуз', 'Университет Естественных Наук')  # Экспорт расписания для Университета Естественных Наук
    export_schedule_to_excel('вуз', 'Университет Химических Технологий')  # Экспорт расписания для Университета Химических Технологий
    export_schedule_to_excel('вуз', 'Университет Биологии')  # Экспорт расписания для Университета Биологии
    export_schedule_to_excel('вуз', 'Университет Географии')  # Экспорт расписания для Университета Географии
    export_schedule_to_excel('вуз', 'Университет Литературы')  # Экспорт расписания для Университета Литературы
    export_schedule_to_excel('вуз', 'Университет Компьютерных Наук')  # Экспорт расписания для Университета Компьютерных Наук
    export_schedule_to_excel('вуз', 'Университет Спорта')  # Экспорт расписания для Университета Спорта


