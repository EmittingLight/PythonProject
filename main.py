import pandas as pd
import os

# Папки проекта
DB_FOLDER = os.path.abspath('./db')
OUTPUT_FOLDER = os.path.abspath('./output')

# Проверка и создание папок, если они не существуют
os.makedirs(DB_FOLDER, exist_ok=True)
os.makedirs(OUTPUT_FOLDER, exist_ok=True)

# Путь к файлу базы данных Excel
DB_PATH = os.path.join(DB_FOLDER, 'schedule.xlsx')

# Функция для создания базы данных в Excel
def create_excel_db():
    # Данные расписания
    schedule_data = [
        {'имя_группы': 'Группа А', 'предмет': 'Математика', 'день': 'Понедельник', 'время': '10:00', 'Преподаватель': 'Иван Иванов'},
        {'имя_группы': 'Группа А', 'предмет': 'Физика', 'день': 'Среда', 'время': '12:00', 'Преподаватель': 'Петр Петров'},
        {'имя_группы': 'Группа Б', 'предмет': 'Химия', 'день': 'Вторник', 'время': '09:00', 'Преподаватель': 'Сидр Сидоров'},
        {'имя_группы': 'Группа В', 'предмет': 'Биология', 'день': 'Понедельник', 'время': '11:00', 'Преподаватель': 'Анна Антонова'},
        {'имя_группы': 'Группа В', 'предмет': 'История', 'день': 'Четверг', 'время': '14:00', 'Преподаватель': 'Мария Марьина'},
        {'имя_группы': 'Группа Г', 'предмет': 'География', 'день': 'Пятница', 'время': '13:00', 'Преподаватель': 'Олег Олегов'},
        {'имя_группы': 'Группа Г', 'предмет': 'Литература', 'день': 'Среда', 'время': '15:00', 'Преподаватель': 'Наталья Наталова'},
        {'имя_группы': 'Группа Д', 'предмет': 'Информатика', 'день': 'Понедельник', 'время': '09:00', 'Преподаватель': 'Алексей Алексеев'},
        {'имя_группы': 'Группа Д', 'предмет': 'Физкультура', 'день': 'Вторник', 'время': '16:00', 'Преподаватель': 'Владимир Владимиров'}
    ]

    # Создание DataFrame из данных расписания
    df = pd.DataFrame(schedule_data)

    # Сохранение базы данных в Excel
    df.to_excel(DB_PATH, index=False, engine='openpyxl')  # Указываем движок 'openpyxl'
    print(f"База данных расписания создана в файле {DB_PATH}")

# Функция для экспорта данных в Excel для указанной группы
def export_schedule_to_excel(group_name):
    # Чтение базы данных из Excel
    df = pd.read_excel(DB_PATH, engine='openpyxl')  # Указываем движок 'openpyxl'

    # Проверка, что данные загружены правильно
    if df.empty:
        print(f"Файл {DB_PATH} пустой или не содержит данных.")
        return

    # Фильтрация данных по группе
    filtered_data = df[df['имя_группы'] == group_name]

    # Проверка, если данные для данной группы найдены
    if filtered_data.empty:
        print(f"Данные для группы {group_name} не найдены.")
    else:
        # Сохранение результата в файл Excel
        output_file = os.path.join(OUTPUT_FOLDER, f"{group_name}_schedule.xlsx")
        filtered_data.to_excel(output_file, index=False, engine='openpyxl')
        print(f"Расписание для группы {group_name} сохранено в файл {output_file}")

if __name__ == "__main__":
    # Создание базы данных в Excel
    create_excel_db()
    # Экспорт расписания в Excel для всех групп
    export_schedule_to_excel('Группа А')
    export_schedule_to_excel('Группа Б')
    export_schedule_to_excel('Группа В')
    export_schedule_to_excel('Группа Г')
    export_schedule_to_excel('Группа Д')
