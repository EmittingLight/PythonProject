import pandas as pd
import os

# Папки проекта
DB_FOLDER = os.path.abspath('./db')
OUTPUT_FOLDER = os.path.abspath('./output')

# Проверка и создание папок, если они не существуют
os.makedirs(DB_FOLDER, exist_ok=True)
os.makedirs(OUTPUT_FOLDER, exist_ok=True)

# Путь к файлу базы данных Excel
DB_PATH = os.path.join(DB_FOLDER, 'schedule.xlsx')

# Функция для создания базы данных в Excel
def create_excel_db():
    # Данные расписания
    schedule_data = [
        {'вуз': 'Университет Естественных Наук', 'факультет': 'Факультет Естественных Наук', 'имя_группы': 'Группа А', 'предмет': 'Математика', 'день': 'Понедельник', 'время': '10:00', 'Преподаватель': 'Иван Иванов'},
        {'вуз': 'Университет Естественных Наук', 'факультет': 'Факультет Естественных Наук', 'имя_группы': 'Группа А', 'предмет': 'Физика', 'день': 'Среда', 'время': '12:00', 'Преподаватель': 'Петр Петров'},
        {'вуз': 'Университет Химических Технологий', 'факультет': 'Факультет Химии', 'имя_группы': 'Группа Б', 'предмет': 'Химия', 'день': 'Вторник', 'время': '09:00', 'Преподаватель': 'Сидр Сидоров'},
        {'вуз': 'Университет Биологии', 'факультет': 'Факультет Биологии', 'имя_группы': 'Группа В', 'предмет': 'Биология', 'день': 'Понедельник', 'время': '11:00', 'Преподаватель': 'Анна Антонова'},
        {'вуз': 'Университет Биологии', 'факультет': 'Факультет Истории', 'имя_группы': 'Группа В', 'предмет': 'История', 'день': 'Четверг', 'время': '14:00', 'Преподаватель': 'Мария Марьина'},
        {'вуз': 'Университет Географии', 'факультет': 'Факультет Географии', 'имя_группы': 'Группа Г', 'предмет': 'География', 'день': 'Пятница', 'время': '13:00', 'Преподаватель': 'Олег Олегов'},
        {'вуз': 'Университет Литературы', 'факультет': 'Факультет Литературы', 'имя_группы': 'Группа Г', 'предмет': 'Литература', 'день': 'Среда', 'время': '15:00', 'Преподаватель': 'Наталья Наталова'},
        {'вуз': 'Университет Компьютерных Наук', 'факультет': 'Факультет Компьютерных Наук', 'имя_группы': 'Группа Д', 'предмет': 'Информатика', 'день': 'Понедельник', 'время': '09:00', 'Преподаватель': 'Алексей Алексеев'},
        {'вуз': 'Университет Спорта', 'факультет': 'Факультет Спорта', 'имя_группы': 'Группа Д', 'предмет': 'Физкультура', 'день': 'Вторник', 'время': '16:00', 'Преподаватель': 'Владимир Владимиров'}
    ]

    # Создание DataFrame из данных расписания
    df = pd.DataFrame(schedule_data)

    # Сохранение базы данных в Excel
    df.to_excel(DB_PATH, index=False, engine='openpyxl')  # Указываем движок 'openpyxl'
    print(f"База данных расписания создана в файле {DB_PATH}")

# Функция для экспорта данных в Excel для указанного уровня (группа, факультет, вуз)
def export_schedule_to_excel(level, name=None):
    # Чтение базы данных из Excel
    df = pd.read_excel(DB_PATH, engine='openpyxl')  # Указываем движок 'openpyxl'

    # Проверка, что данные загружены правильно
    if df.empty:
        print(f"Файл {DB_PATH} пустой или не содержит данных.")
        return

    # Фильтрация данных в зависимости от уровня
    if level == 'группа' and name is not None:
        filtered_data = df[df['имя_группы'] == name]
        output_file = os.path.join(OUTPUT_FOLDER, f"{name}_schedule.xlsx")
    elif level == 'факультет' and name is not None:
        filtered_data = df[df['факультет'] == name]
        output_file = os.path.join(OUTPUT_FOLDER, f"{name}_faculty_schedule.xlsx")
    elif level == 'вуз' and name is not None:
        filtered_data = df[df['вуз'] == name]
        output_file = os.path.join(OUTPUT_FOLDER, f"{name}_university_schedule.xlsx")
    else:
        print("Неверный уровень или имя для фильтрации.")
        return

    # Проверка, если данные найдены
    if filtered_data.empty:
        print(f"Данные для {name} не найдены.")
    else:
        # Сохранение результата в файл Excel
        filtered_data.to_excel(output_file, index=False, engine='openpyxl')
        print(f"Расписание для уровня '{level}' сохранено в файл {output_file}")

if __name__ == "__main__":
    # Создание базы данных в Excel
    create_excel_db()
    # Экспорт расписания в Excel для всех уровней
    """export_schedule_to_excel('группа', 'Группа А')
    export_schedule_to_excel('группа', 'Группа Б')
    export_schedule_to_excel('группа', 'Группа В')
    export_schedule_to_excel('группа', 'Группа Г')
    export_schedule_to_excel('группа', 'Группа Д')
    export_schedule_to_excel('факультет', 'Факультет Естественных Наук')
    export_schedule_to_excel('факультет', 'Факультет Химии')
    export_schedule_to_excel('факультет', 'Факультет Биологии')
    export_schedule_to_excel('факультет', 'Факультет Истории')
    export_schedule_to_excel('факультет', 'Факультет Географии')
    export_schedule_to_excel('факультет', 'Факультет Литературы')
    export_schedule_to_excel('факультет', 'Факультет Компьютерных Наук')
    export_schedule_to_excel('факультет', 'Факультет Спорта')"""
    export_schedule_to_excel('вуз', 'Университет Естественных Наук')
    export_schedule_to_excel('вуз', 'Университет Химических Технологий')
    export_schedule_to_excel('вуз', 'Университет Биологии')
    export_schedule_to_excel('вуз', 'Университет Географии')
    export_schedule_to_excel('вуз', 'Университет Литературы')
    export_schedule_to_excel('вуз', 'Университет Компьютерных Наук')
    export_schedule_to_excel('вуз', 'Университет Спорта')


